# Инструкция по интеграции автоимпорта

## Шаг 1: Обновить models.py

В файле `models.py` добавлены 3 новые модели:
- `AutoImportSettings` - настройки автоимпорта для продавца
- `ImportedProduct` - импортированные товары
- `CategoryMapping` - маппинг категорий

Эти модели уже добавлены в код.

## Шаг 2: Применить миграцию БД

```bash
python migrate_add_auto_import.py
```

Это создаст необходимые таблицы и добавит предустановленные маппинги категорий.

## Шаг 3: Установить зависимости

```bash
pip install Pillow==10.4.0
```

Или установить все зависимости:
```bash
pip install -r requirements.txt
```

## Шаг 4: Интегрировать роуты в seller_platform.py

Добавьте в конец файла `seller_platform.py` ПЕРЕД строкой `if __name__ == '__main__':`:

```python
# ============= РОУТЫ АВТОИМПОРТА =============
# Регистрация роутов автоимпорта
from auto_import_routes import register_auto_import_routes
register_auto_import_routes(app)
```

## Шаг 5: Добавить ссылку в меню навигации

В файле `templates/base.html` найдите навигационное меню и добавьте пункт:

```html
<a href="{{ url_for('auto_import_dashboard') }}"
   class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-indigo-700">
    Автоимпорт
</a>
```

## Шаг 6: Запустить приложение

```bash
python seller_platform.py
```

## Шаг 7: Настройка автоимпорта

1. Войдите в систему как продавец
2. Перейдите в раздел "Автоимпорт"
3. Нажмите "Настройки"
4. Заполните:
   - **Код поставщика**: например `SP001`
   - **URL CSV файла**: URL вашего CSV файла с товарами
   - **Тип источника**: `sexoptovik` (по умолчанию)
5. Настройте параметры импорта по желанию
6. Нажмите "Сохранить настройки"

## Шаг 8: Запуск импорта

На дашборде автоимпорта нажмите кнопку "Запустить импорт".

Импорт запустится в фоновом режиме и будет:
1. Скачивать CSV файл
2. Парсить товары
3. Определять категории WB
4. Валидировать каждый товар
5. Сохранять в БД со статусом `validated`

## Тестирование

Для тестирования используйте файл `test_products.csv`:

```bash
# Запустите локальный веб-сервер для CSV
python -m http.server 8080
```

Затем укажите в настройках:
- URL: `http://localhost:8080/test_products.csv`

## Файлы проекта

Новые файлы:
- `auto_import_manager.py` - основная логика автоимпорта
- `auto_import_routes.py` - Flask роуты
- `migrate_add_auto_import.py` - миграция БД
- `AUTO_IMPORT_README.md` - полная документация
- `test_products.csv` - тестовые данные
- `templates/auto_import_dashboard.html` - дашборд
- `templates/auto_import_settings.html` - настройки

Обновленные файлы:
- `models.py` - добавлены 3 новые модели
- `requirements.txt` - добавлен Pillow

## Troubleshooting

### Ошибка импорта модулей
Убедитесь, что все файлы находятся в корневой директории проекта.

### Ошибка БД
Если таблицы не созданы, запустите миграцию:
```bash
python migrate_add_auto_import.py
```

### Ошибка импорта роутов
Проверьте, что файл `auto_import_routes.py` существует и добавлена регистрация роутов в `seller_platform.py`.

## Готово!

Теперь у вас есть полноценная система автоимпорта товаров с веб-интерфейсом!
