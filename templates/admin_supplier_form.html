{% extends "base.html" %}

{% block title %}{{ 'Редактирование' if mode == 'edit' else 'Новый' }} поставщик — Админ{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Хлебные крошки -->
    <nav class="mb-6 text-sm text-gray-500">
        <a href="{{ url_for('admin_suppliers') }}" class="hover:text-indigo-600">Поставщики</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900">{{ supplier.name if supplier else 'Новый поставщик' }}</span>
    </nav>

    <div class="flex gap-8">
        <!-- Основная форма -->
        <div class="flex-1">
            <h1 class="text-2xl font-bold text-gray-900 mb-6">
                {{ 'Редактирование: ' + supplier.name if mode == 'edit' else 'Новый поставщик' }}
            </h1>

            <form method="POST"
                action="{{ url_for('admin_supplier_edit', supplier_id=supplier.id) if mode == 'edit' else url_for('admin_supplier_add') }}"
                x-data="{ tab: 'basic' }">

                <!-- Табы -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="-mb-px flex space-x-6">
                        <button type="button" @click="tab = 'basic'"
                            :class="tab === 'basic' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="pb-3 px-1 border-b-2 font-medium text-sm">Основное</button>
                        <button type="button" @click="tab = 'source'"
                            :class="tab === 'source' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="pb-3 px-1 border-b-2 font-medium text-sm">Источник данных</button>
                        <button type="button" @click="tab = 'ai'"
                            :class="tab === 'ai' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="pb-3 px-1 border-b-2 font-medium text-sm">AI настройки</button>
                        <button type="button" @click="tab = 'photo'"
                            :class="tab === 'photo' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="pb-3 px-1 border-b-2 font-medium text-sm">Фото</button>
                    </nav>
                </div>

                <!-- Таб: Основное -->
                <div x-show="tab === 'basic'" class="space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Название *</label>
                            <input type="text" name="name" required value="{{ supplier.name if supplier else '' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Код (slug) *</label>
                            <input type="text" name="code" required value="{{ supplier.code if supplier else '' }}"
                                {{ 'readonly' if mode=='edit' else '' }} pattern="[a-z0-9_-]+" placeholder="sexoptovik"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2 {{ 'bg-gray-100' if mode == 'edit' else '' }}">
                            <p class="mt-1 text-xs text-gray-400">Латиница, цифры, дефис, подчёркивание</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Описание</label>
                        <textarea name="description" rows="3"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">{{ supplier.description if supplier and supplier.description else '' }}</textarea>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Сайт</label>
                            <input type="url" name="website"
                                value="{{ supplier.website if supplier and supplier.website else '' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Наценка по умолчанию (%)</label>
                            <input type="number" name="default_markup_percent" step="0.1"
                                value="{{ supplier.default_markup_percent if supplier and supplier.default_markup_percent else '' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                    </div>
                    <label class="flex items-center gap-2 mt-2">
                        <input type="checkbox" name="is_active" {{ 'checked' if not supplier or supplier.is_active
                            else '' }} class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">Активен</span>
                    </label>
                </div>

                <!-- Таб: Источник данных -->
                <div x-show="tab === 'source'" x-cloak class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">URL CSV файла</label>
                        <input type="url" name="csv_source_url"
                            value="{{ supplier.csv_source_url if supplier and supplier.csv_source_url else '' }}"
                            placeholder="http://sexoptovik.ru/files/all_prod_prices__.csv"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Разделитель CSV</label>
                            <input type="text" name="csv_delimiter"
                                value="{{ supplier.csv_delimiter if supplier else ';' }}" maxlength="5"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Кодировка CSV</label>
                            <select name="csv_encoding"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                                <option value="cp1251" {{ 'selected' if supplier and supplier.csv_encoding=='cp1251'
                                    else '' }}>cp1251 (Windows)</option>
                                <option value="utf-8" {{ 'selected' if supplier and supplier.csv_encoding=='utf-8'
                                    else '' }}>UTF-8</option>
                            </select>
                        </div>
                    </div>
                    <hr class="my-4">
                    <h3 class="text-sm font-semibold text-gray-700">Файл цен и остатков</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">URL файла цен/остатков</label>
                        <input type="url" name="price_file_url"
                            value="{{ supplier.price_file_url if supplier and supplier.price_file_url else '' }}"
                            placeholder="http://sexoptovik.ru/files/all_prod_prices__.csv"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        <p class="mt-1 text-xs text-gray-400">CSV:
                            id;артикул;цена;наличие;статус;доп.артикул;штрихкод;ррц</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">URL INF файла (определение
                            обновлений)</label>
                        <input type="url" name="price_file_inf_url"
                            value="{{ supplier.price_file_inf_url if supplier and supplier.price_file_inf_url else '' }}"
                            placeholder="http://sexoptovik.ru/files/all_prod_prices__.inf"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Разделитель файла цен</label>
                            <input type="text" name="price_file_delimiter"
                                value="{{ supplier.price_file_delimiter if supplier else ';' }}" maxlength="5"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Кодировка файла цен</label>
                            <select name="price_file_encoding"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                                <option value="cp1251" {{ 'selected' if supplier and
                                    supplier.price_file_encoding=='cp1251' else '' }}>cp1251 (Windows)</option>
                                <option value="utf-8" {{ 'selected' if supplier and
                                    supplier.price_file_encoding=='utf-8' else '' }}>UTF-8</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 items-end">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" name="auto_sync_prices" {{ 'checked' if supplier and
                                supplier.auto_sync_prices else '' }}
                                class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="text-sm text-gray-700">Автосинхронизация цен</span>
                        </label>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Интервал (мин)</label>
                            <input type="number" name="auto_sync_interval_minutes" min="5" step="5"
                                value="{{ supplier.auto_sync_interval_minutes if supplier and supplier.auto_sync_interval_minutes else 60 }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                    </div>
                    {% if mode == 'edit' and supplier.last_price_sync_at %}
                    <div class="bg-gray-50 rounded-lg p-3 text-sm">
                        <span class="text-gray-500">Последняя синхронизация цен:</span>
                        <span
                            class="font-medium {{ 'text-green-600' if supplier.last_price_sync_status == 'success' else 'text-red-600' }}">
                            {{ supplier.last_price_sync_at.strftime('%d.%m.%Y %H:%M') }}
                            ({{ supplier.last_price_sync_status }})
                        </span>
                        {% if supplier.last_price_sync_error %}
                        <p class="text-red-500 text-xs mt-1">{{ supplier.last_price_sync_error[:200] }}</p>
                        {% endif %}
                    </div>
                    {% endif %}

                    <hr class="my-4">
                    <h3 class="text-sm font-semibold text-gray-700">Файл описаний товаров</h3>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">URL CSV с описаниями</label>
                        <input type="url" name="description_file_url"
                            value="{{ supplier.description_file_url if supplier and supplier.description_file_url else '' }}"
                            placeholder="http://sexoptovik.ru/files/all_prod_descriptions.csv"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        <p class="mt-1 text-xs text-gray-400">CSV: id;описание — описания подтянутся к товарам по ID</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Разделитель</label>
                            <input type="text" name="description_file_delimiter"
                                value="{{ supplier.description_file_delimiter if supplier else ';' }}" maxlength="5"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Кодировка</label>
                            <select name="description_file_encoding"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                                <option value="cp1251" {{ 'selected' if supplier and
                                    supplier.description_file_encoding=='cp1251' else '' }}>cp1251 (Windows)</option>
                                <option value="utf-8" {{ 'selected' if supplier and
                                    supplier.description_file_encoding=='utf-8' else '' }}>UTF-8</option>
                            </select>
                        </div>
                    </div>
                    {% if mode == 'edit' and supplier.last_description_sync_at %}
                    <div class="bg-gray-50 rounded-lg p-3 text-sm">
                        <span class="text-gray-500">Последняя синхронизация описаний:</span>
                        <span
                            class="font-medium {{ 'text-green-600' if supplier.last_description_sync_status == 'success' else 'text-orange-600' }}">
                            {{ supplier.last_description_sync_at.strftime('%d.%m.%Y %H:%M') }}
                            ({{ supplier.last_description_sync_status }})
                        </span>
                    </div>
                    {% endif %}

                    <hr class="my-4">
                    <h3 class="text-sm font-semibold text-gray-700">Авторизация (для доступа к фото)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Логин</label>
                            <input type="text" name="auth_login"
                                value="{{ supplier.auth_login if supplier and supplier.auth_login else '' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Пароль</label>
                            <input type="password" name="auth_password"
                                placeholder="{{ '********' if mode == 'edit' else '' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                    </div>
                </div>

                <!-- Таб: AI настройки -->
                <div x-show="tab === 'ai'" x-cloak class="space-y-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" name="ai_enabled" {{ 'checked' if supplier and supplier.ai_enabled
                            else '' }} class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">Использовать AI для валидации и генерации</span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Провайдер</label>
                            <select name="ai_provider"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                                <option value="openai" {{ 'selected' if supplier and supplier.ai_provider=='openai'
                                    else '' }}>OpenAI</option>
                                <option value="cloudru" {{ 'selected' if supplier and supplier.ai_provider=='cloudru'
                                    else '' }}>Cloud.ru</option>
                                <option value="custom" {{ 'selected' if supplier and supplier.ai_provider=='custom'
                                    else '' }}>Кастомный API</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Модель</label>
                            <input type="text" name="ai_model"
                                value="{{ supplier.ai_model if supplier and supplier.ai_model else 'gpt-4o-mini' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">API ключ</label>
                        <input type="password" name="ai_api_key"
                            placeholder="{{ '********' if mode == 'edit' else '' }}"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Base URL API (для
                            кастомного)</label>
                        <input type="url" name="ai_api_base_url"
                            value="{{ supplier.ai_api_base_url if supplier and supplier.ai_api_base_url else '' }}"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Температура</label>
                            <input type="number" name="ai_temperature" step="0.1" min="0" max="2"
                                value="{{ supplier.ai_temperature if supplier else 0.3 }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Макс. токенов</label>
                            <input type="number" name="ai_max_tokens"
                                value="{{ supplier.ai_max_tokens if supplier else 2000 }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Таймаут (с)</label>
                            <input type="number" name="ai_timeout" value="{{ supplier.ai_timeout if supplier else 60 }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Инструкция для категорий</label>
                        <textarea name="ai_category_instruction" rows="2"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">{{ supplier.ai_category_instruction if supplier and supplier.ai_category_instruction else '' }}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Инструкция для описаний</label>
                        <textarea name="ai_description_instruction" rows="2"
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">{{ supplier.ai_description_instruction if supplier and supplier.ai_description_instruction else '' }}</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Инструкция для AI парсинга (полное
                            извлечение характеристик)</label>
                        <textarea name="ai_parsing_instruction" rows="2"
                            placeholder="Оставьте пустым для стандартной инструкции. Опционально: укажите специфику товаров поставщика."
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">{{ supplier.ai_parsing_instruction if supplier and supplier.ai_parsing_instruction else '' }}</textarea>
                    </div>
                </div>

                <!-- Таб: Фото настройки -->
                <div x-show="tab === 'photo'" x-cloak class="space-y-4">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" name="resize_images" {{ 'checked' if not supplier or
                            supplier.resize_images else '' }}
                            class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm text-gray-700">Приводить фото к единому размеру</span>
                    </label>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Целевой размер (px)</label>
                            <input type="number" name="image_target_size"
                                value="{{ supplier.image_target_size if supplier else 1200 }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Цвет фона</label>
                            <input type="text" name="image_background_color"
                                value="{{ supplier.image_background_color if supplier else 'white' }}"
                                class="w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm border px-3 py-2">
                        </div>
                    </div>
                </div>

                <!-- Кнопки -->
                <div class="mt-8 flex items-center justify-between border-t border-gray-200 pt-6">
                    <div>
                        {% if mode == 'edit' %}
                        <button type="button"
                            onclick="if(confirm('Удалить поставщика и все его товары?')) document.getElementById('delete-form').submit()"
                            class="text-sm text-red-600 hover:text-red-800 font-medium">Удалить поставщика</button>
                        {% endif %}
                    </div>
                    <div class="flex gap-3">
                        <a href="{{ url_for('admin_suppliers') }}"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">Отмена</a>
                        <button type="submit"
                            class="px-6 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700">
                            {{ 'Сохранить' if mode == 'edit' else 'Создать' }}
                        </button>
                    </div>
                </div>
            </form>

            {% if mode == 'edit' %}
            <form id="delete-form" method="POST"
                action="{{ url_for('admin_supplier_delete', supplier_id=supplier.id) }}" class="hidden"></form>
            {% endif %}
        </div>

        <!-- Сайдбар со статистикой (только edit) -->
        {% if mode == 'edit' and stats %}
        <div class="w-72 flex-shrink-0">
            <div class="bg-white rounded-lg border border-gray-200 p-5 sticky top-8">
                <h3 class="text-sm font-semibold text-gray-900 mb-4">Статистика</h3>
                <dl class="space-y-3">
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Всего товаров</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ stats.total }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Готовых</dt>
                        <dd class="text-sm font-semibold text-green-600">{{ stats.ready }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">AI валидированы</dt>
                        <dd class="text-sm font-semibold text-purple-600">{{ stats.ai_validated }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">С фото</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ stats.with_photos }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Брендов</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ stats.brands }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Категорий</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ stats.categories }}</dd>
                    </div>
                </dl>

                {% if price_stock_stats %}
                <hr class="my-4">
                <h3 class="text-sm font-semibold text-gray-900 mb-3">Остатки и цены</h3>
                <dl class="space-y-3">
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">В наличии</dt>
                        <dd class="text-sm font-semibold text-green-600">{{ price_stock_stats.in_stock }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Нет в наличии</dt>
                        <dd class="text-sm font-semibold text-red-500">{{ price_stock_stats.out_of_stock }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">С ценой</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ price_stock_stats.with_price }}</dd>
                    </div>
                    {% if price_stock_stats.min_price > 0 %}
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Мин. / Макс. цена</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ '%.0f'|format(price_stock_stats.min_price) }}
                            / {{ '%.0f'|format(price_stock_stats.max_price) }} &#8381;</dd>
                    </div>
                    {% endif %}
                    {% if price_stock_stats.total_stock > 0 %}
                    <div class="flex justify-between">
                        <dt class="text-sm text-gray-500">Общий остаток</dt>
                        <dd class="text-sm font-semibold text-gray-900">{{ price_stock_stats.total_stock }}</dd>
                    </div>
                    {% endif %}
                </dl>
                {% endif %}

                <div class="mt-6 space-y-2">
                    <a href="{{ url_for('admin_supplier_products', supplier_id=supplier.id) }}"
                        class="block w-full text-center px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-100">
                        Товары
                    </a>
                    {% if supplier.price_file_url %}
                    <form method="POST" action="{{ url_for('admin_supplier_sync_prices', supplier_id=supplier.id) }}"
                        class="inline w-full">
                        <input type="hidden" name="force" value="1">
                        <button type="submit" onclick="return confirm('Синхронизировать цены и остатки?')"
                            class="block w-full text-center px-4 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-medium hover:bg-green-100">
                            Синхр. цены/остатки
                        </button>
                    </form>
                    {% endif %}
                    <a href="{{ url_for('admin_supplier_marketplaces', supplier_id=supplier.id) }}"
                        class="block w-full text-center px-4 py-2 bg-purple-50 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-100 mb-2 mt-2">
                        Интеграции маркетплейсов
                    </a>
                    <a href="{{ url_for('admin_supplier_sellers', supplier_id=supplier.id) }}"
                        class="block w-full text-center px-4 py-2 bg-gray-50 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100">
                        Продавцы
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}