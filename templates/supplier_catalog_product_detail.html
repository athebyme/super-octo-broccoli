{% extends "base.html" %}

{% block title %}{{ product.title or 'Товар' }} — {{ supplier.name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <nav class="mb-4 text-sm text-gray-500">
        <a href="{{ url_for('supplier_catalog') }}" class="hover:text-indigo-600">Каталог</a>
        <span class="mx-2">/</span>
        <a href="{{ url_for('supplier_catalog_products', supplier_id=supplier.id) }}" class="hover:text-indigo-600">{{ supplier.name }}</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900">{{ (product.title or 'Товар')[:40] }}</span>
    </nav>

    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
        <!-- Заголовок -->
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-start justify-between">
                <div>
                    <h1 class="text-xl font-bold text-gray-900">{{ product.title or 'Без названия' }}</h1>
                    <p class="text-sm text-gray-500 mt-1">
                        {{ product.brand or '' }}
                        {% if product.category %} | {{ product.category }}{% endif %}
                    </p>
                </div>
                {% if existing_import %}
                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
                    &#10003; Импортирован
                </span>
                {% endif %}
            </div>
        </div>

        <!-- Фотографии -->
        {% set photos = product.get_photos() %}
        {% if photos %}
        <div class="p-6 border-b border-gray-200">
            <div class="flex gap-3 overflow-x-auto pb-2">
                {% for photo in photos[:10] %}
                <img src="{{ photo.get('blur', photo.get('original', '')) if photo is mapping else photo }}"
                     class="w-32 h-32 object-cover rounded-lg flex-shrink-0 border border-gray-200"
                     onerror="this.style.display='none'" alt="">
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Информация -->
        <div class="p-6">
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6">
                <div>
                    <dt class="text-xs text-gray-500">Цена поставщика</dt>
                    <dd class="text-lg font-bold text-gray-900 mt-0.5">
                        {{ '%.0f ₽'|format(product.supplier_price) if product.supplier_price else '—' }}
                    </dd>
                </div>
                <div>
                    <dt class="text-xs text-gray-500">Остаток</dt>
                    <dd class="text-lg font-bold text-gray-900 mt-0.5">{{ product.supplier_quantity or '—' }}</dd>
                </div>
                <div>
                    <dt class="text-xs text-gray-500">Пол</dt>
                    <dd class="text-sm text-gray-900 mt-0.5">{{ product.gender or '—' }}</dd>
                </div>
                <div>
                    <dt class="text-xs text-gray-500">Страна</dt>
                    <dd class="text-sm text-gray-900 mt-0.5">{{ product.country or '—' }}</dd>
                </div>
            </div>

            {% if product.description or product.ai_description %}
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">Описание</h3>
                <p class="text-sm text-gray-600">{{ product.ai_description or product.description }}</p>
            </div>
            {% endif %}

            {% if product.ai_seo_title %}
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">SEO заголовок</h3>
                <p class="text-sm text-gray-800 font-medium">{{ product.ai_seo_title }}</p>
            </div>
            {% endif %}

            {% if product.wb_category_name %}
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-2">Категория WB</h3>
                <p class="text-sm text-gray-600">{{ product.wb_category_name }}
                    {% if product.wb_subject_id %} (ID: {{ product.wb_subject_id }}){% endif %}
                </p>
            </div>
            {% endif %}

            <div class="text-xs text-gray-400">
                ID: {{ product.external_id }} | Артикул: {{ product.vendor_code or '—' }} | Баркод: {{ product.barcode or '—' }}
            </div>
        </div>
    </div>

    <!-- Действия -->
    <div class="mt-6 flex justify-between items-center">
        <a href="{{ url_for('supplier_catalog_products', supplier_id=supplier.id) }}"
           class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">&larr; Назад</a>

        {% if not existing_import %}
        <form method="POST" action="{{ url_for('supplier_catalog_import') }}">
            <input type="hidden" name="supplier_id" value="{{ supplier.id }}">
            <input type="hidden" name="product_ids" value="{{ product.id }}">
            <button type="submit" onclick="return confirm('Импортировать этот товар?')"
                    class="px-6 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700">
                Импортировать к себе
            </button>
        </form>
        {% else %}
        <div class="flex gap-2">
            <span class="px-4 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-medium">Уже импортирован</span>
            <form method="POST" action="{{ url_for('supplier_catalog_update') }}">
                <input type="hidden" name="supplier_id" value="{{ supplier.id }}">
                <input type="hidden" name="product_ids" value="{{ product.id }}">
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">
                    Обновить из базы
                </button>
            </form>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
