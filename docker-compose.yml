version: "3.9"

services:
  seller-platform:
    build: .
    container_name: seller-platform
    environment:
      - APP_MODULE=seller_platform:app
      - PORT=${SELLER_PORT:-5001}
      - SECRET_KEY=${SECRET_KEY:-wb-seller-platform-secret-key-change-in-production}
      # ЖЁСТКО ПРОПИСЫВАЕМ DATABASE_URL - НЕ полагаемся на .env
      - DATABASE_URL=sqlite:////app/data/seller_platform.db
      - ENCRYPTION_KEY=${ENCRYPTION_KEY:-}
      # Credentials для первого администратора (создается автоматически при первом запуске)
      - ADMIN_USERNAME=${ADMIN_USERNAME:-admin}
      - ADMIN_EMAIL=${ADMIN_EMAIL:-admin@example.com}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}
      # SSL/HTTPS (оставьте пустыми для авто-генерации self-signed)
      - SSL_CERT_PATH=${SSL_CERT_PATH:-}
      - SSL_KEY_PATH=${SSL_KEY_PATH:-}
      - SSL_COMMON_NAME=${SSL_COMMON_NAME:-seller-platform}
    ports:
      - "${SELLER_PORT:-5001}:${SELLER_PORT:-5001}"
    volumes:
      - ./uploads:/app/uploads
      - ./processed:/app/processed
      - seller_platform_data:/app/data
    restart: unless-stopped

  wb-calculator:
    build: .
    container_name: wb-calculator
    environment:
      - APP_MODULE=app:app
      - PORT=${CALCULATOR_PORT:-5000}
      - APP_SECRET_KEY=${APP_SECRET_KEY:-wb-calculator-secret}
    ports:
      - "${CALCULATOR_PORT:-5000}:5000"
    volumes:
      - ./uploads:/app/uploads
      - ./processed:/app/processed
      - ./data:/app/data
    restart: unless-stopped

volumes:
  seller_platform_data:
    driver: local

