# üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Docker (Data Persistence)

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

–ï—Å–ª–∏ —É –≤–∞—Å —Ç–µ—Ä—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥—Ä—É–∑–∫–∏) –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `docker-compose down`, —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ Docker** –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º —Å volumes.

---

## ‚úÖ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å Docker

### 1Ô∏è‚É£ Volumes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–í `docker-compose.yml` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã bind mounts:

```yaml
volumes:
  - ./data:/app/data          # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  - ./uploads:/app/uploads    # –ó–∞–≥—Ä—É–∑–∫–∏
  - ./processed:/app/processed # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–∞–ø–∫–∏ –Ω–∞ —Ö–æ—Å—Ç–µ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. **–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è!**

### 2Ô∏è‚É£ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

#### ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π)
docker-compose restart seller-platform

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d --build seller-platform

# –í–∞—Ä–∏–∞–Ω—Ç 3: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose stop
docker-compose start
```

#### ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è** –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (volumes –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è)
docker-compose down

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker-compose build seller-platform

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d
```

#### ‚ùå **–û–ü–ê–°–ù–´–ï** –∫–æ–º–∞–Ω–¥—ã (—É–¥–∞–ª—è—Ç volumes):

```bash
# –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö! –£–¥–∞–ª–∏—Ç –≤—Å–µ volumes –∏ –¥–∞–Ω–Ω—ã–µ
docker-compose down -v
docker-compose down --volumes
docker-compose rm -v
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Ö–æ—Å—Ç–µ:

```bash
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª seller_platform.db
ls -lh ./data/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–∞–∑–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
file ./data/seller_platform.db

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã
du -h ./data/seller_platform.db
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose exec seller-platform sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –∫ –±–∞–∑–µ
ls -lh /app/data/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ volume —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
df -h | grep /app/data
```

---

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ë–∞–∑–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ ./data/

**–°–∏–º–ø—Ç–æ–º:** –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ `./data/` –Ω–µ—Ç —Ñ–∞–π–ª–∞ `seller_platform.db`

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `DATABASE_URL` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `.env`:
   ```
   DATABASE_URL=sqlite:////app/data/seller_platform.db
   ```
   (4 —Å–ª–µ—à–∞ –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø—É—Ç–∏!)

2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   docker-compose logs seller-platform | grep "–ë–î"
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ "database is locked"

**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∏ `sqlite3.OperationalError: database is locked`

**–†–µ—à–µ–Ω–∏–µ:**
- SQLite –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –£–º–µ–Ω—å—à–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL –¥–ª—è production

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

**–°–∏–º–ø—Ç–æ–º:** –û—à–∏–±–∫–∏ "Permission denied" –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –î–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo chown -R $USER:$USER ./data ./uploads ./processed
chmod -R 755 ./data ./uploads ./processed
```

---

## üìù Workflow –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

```bash
# 1. –ó–∞–±—Ä–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ git
git pull origin <branch-name>

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è!)
docker-compose build seller-platform

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f seller-platform
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
docker-compose restart seller-platform
```

---

## üö® Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é:

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ë–î
cp ./data/seller_platform.db ./data/seller_platform_backup_$(date +%Y%m%d_%H%M%S).db

# –ò–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ SQL
sqlite3 ./data/seller_platform.db .dump > backup.sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose stop seller-platform

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª
cp ./data/seller_platform_backup_XXXXXX.db ./data/seller_platform.db

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose start seller-platform
```

---

## üì¶ Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

1. **Named volumes** –≤–º–µ—Å—Ç–æ bind mounts (–Ω–∞–¥–µ–∂–Ω–µ–µ)
2. **PostgreSQL** –≤–º–µ—Å—Ç–æ SQLite (–ª—É—á—à–µ –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
3. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ backups** (cron job –∫–∞–∂–¥—É—é –Ω–æ—á—å)
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Ä–∞–∑–º–µ—Ä–∞ –ë–î

### –ü—Ä–∏–º–µ—Ä —Å named volumes:

```yaml
# –í docker-compose.yml
volumes:
  - seller_data:/app/data

volumes:
  seller_data:
    driver: local
```

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º

- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç —Ñ–ª–∞–≥–∞ `-v` –≤ –∫–æ–º–∞–Ω–¥–µ `docker-compose down`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `./data/seller_platform.db` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –°–¥–µ–ª–∞—Ç—å backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ volumes –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `docker-compose.yml`
- [ ] –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª `./data/seller_platform.db` –æ—Å—Ç–∞–ª—Å—è

---

## üÜò –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø–æ—Ç–µ—Ä—è–Ω—ã

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `docker-compose down -v`, –¥–∞–Ω–Ω—ã–µ **–±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–µ–Ω—ã**.

–ù—É–∂–Ω–æ:
1. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose up -d`
2. –ó–∞–π—Ç–∏ –ø–æ–¥ admin/admin123
3. –ü–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å WB API
4. –ù–∞ –±—É–¥—É—â–µ–µ - –¥–µ–ª–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ backups!
